#!/usr/bin/env python3

import numpy as np
import h5py
import argparse
#This little utility takes the hdf5 files generated by interpretFlat.py and renders them as numpy arrays that can be fed to the tfmodisco-lite suite. 


def flipAndSave(inpAr, fname):
    ar = np.array(inpAr)
    transAr = np.transpose(ar, [0,2,1])
    print(transAr.shape)
    np.save(fname, transAr)

def main():
    parser = argparse.ArgumentParser(description="A little utility that takes the hdf5-format files generated by interpretFlat.py and saves them as numpy arrays suitable for tfmodisco-lite.")
    parser.add_argument("--h5", help="The name of the hdf5-format file generated by interpretFlat.py")
    parser.add_argument("--seqs", help="The name of the .npy-format file containing the one-hot-encoded sequences. This is an output.")
    parser.add_argument("--scores", help="The name of the .npy-format file containing the hypothetical importance scores. This is an output.")

    args=parser.parse_args()
    inFile = h5py.File(args.h5, "r")
    if(args.seqs is not None):
        flipAndSave(inFile["input_seqs"], args.seqs)
    flipAndSave(inFile["hyp_scores"], args.scores)


if(__name__ == "__main__"):
    main()

